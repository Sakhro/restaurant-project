let restaurant;var map;DBHelper.serviceWorker(),DBHelper.postReviewsFromDB(),window.initMap=()=>{fetchRestaurantFromURL((a,b)=>{a?console.error(a):(self.map=new google.maps.Map(document.getElementById('map'),{zoom:16,center:b.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=(a)=>{if(self.restaurant)return void a(null,self.restaurant);const b=getParameterByName('id');b?DBHelper.fetchRestaurantById(b,(b,c)=>(self.restaurant=c,c?void(fillRestaurantHTML(),a(null,c)):void console.error(b))):(error='No restaurant id in URL',a(error,null))},fillRestaurantHTML=(a=self.restaurant)=>{const b=document.getElementById('review-form');b.setAttribute('data-id',a.id);const c=document.getElementById('restaurant-name');c.innerHTML=a.name;const d=document.getElementById('favorite');d.addEventListener('click',togFav),d.addEventListener('keydown',togFavKey),d.setAttribute('data-id',a.id),d.setAttribute('tabindex',0),d.setAttribute('role','checkbox'),d.setAttribute('aria-label','Mark restaurant as favorite'),d.className=`favorite-icon ${a.is_favorite?'checked':''}`,d.setAttribute('aria-checked',!!a.is_favorite),d.innerHTML=a.is_favorite?'<i class="fas fa-star fa-2x"></i>':'<i class="far fa-star fa-2x"></i>';const e=document.getElementById('restaurant-address');e.innerHTML='<i class="fas fa-map-marker-alt" aria-hidden="true"></i>'+a.address;const f=document.getElementById('restaurant-img');f.className='restaurant-img',f.alt=a.alt,f.src=DBHelper.imageUrlForRestaurant(a);const g=document.getElementById('restaurant-cuisine');g.innerHTML=a.cuisine_type,a.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=(a=self.restaurant.operating_hours)=>{const b=document.getElementById('restaurant-hours');for(let c in a){const d=document.createElement('tr'),e=document.createElement('td');e.innerHTML=c,e.setAttribute('tabindex',0),d.appendChild(e);const f=document.createElement('td');f.innerHTML='<i class="far fa-clock" aria-hidden="true"></i> '+a[c],f.setAttribute('tabindex',0),d.appendChild(f),b.appendChild(d)}},fillReviewsHTML=(a=self.restaurant.id)=>{const b=new Promise((b,c)=>{DBHelper.fetchReviewsByRestaurantId(a,(a,d)=>{d||c(a),b(d)})}),c=document.getElementById('reviews-container'),d=document.createElement('h3');d.innerHTML='Reviews',d.id='reviews-title',c.appendChild(d),b.then((a)=>{if(!a){const a=document.createElement('p');return a.innerHTML='No reviews yet!',void c.appendChild(a)}const b=document.getElementById('reviews-list');a.reverse().forEach((a)=>{b.appendChild(createReviewHTML(a))}),c.appendChild(b)}).catch((a)=>console.error(a))},createReviewHTML=(a)=>{const b=document.createElement('li');b.setAttribute('tabindex',0);const c=document.createElement('header');c.className='review-header';const d=document.createElement('h4');d.innerHTML=a.name,d.className='review-name',c.appendChild(d);const e=document.createElement('p'),f=new Date(a.updatedAt);e.innerHTML=`${f.getDate()}.${f.getMonth()}.${f.getFullYear()}`,e.className='review-date',c.appendChild(e),b.appendChild(c);const g=document.createElement('p');g.innerHTML=`RATING: ${a.rating}`,g.className='review-rating',b.appendChild(g);const h=document.createElement('p');return h.innerHTML=a.comments,b.appendChild(h),b},fillBreadcrumb=(a=self.restaurant)=>{const b=document.getElementById('breadcrumb'),c=document.createElement('li');c.innerHTML=a.name,b.appendChild(c)},getParameterByName=(a,b)=>{b||(b=window.location.href),a=a.replace(/[\[\]]/g,'\\$&');const c=new RegExp(`[?&]${a}(=([^&#]*)|&|#|$)`),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g,' ')):'':null},skipTo=(a)=>{const b=document.getElementById(a);b.focus()},togFav=(a)=>{const b=a.target.parentNode,c=b.dataset.id;b.classList.contains('checked')?(b.innerHTML='<i class="far fa-star fa-2x"></i>',b.classList.remove('checked'),b.setAttribute('aria-checked',!1),DBHelper.addFavoriteRestaurant(c,!1)):(b.innerHTML='<i class="fas fa-star fa-2x"></i>',b.classList.add('checked'),b.setAttribute('aria-checked',!0),DBHelper.addFavoriteRestaurant(c,!0))},togFavKey=(a)=>{if(32===a.keyCode){a.preventDefault();const b=a.target,c=b.dataset.id;b.classList.contains('checked')?(b.innerHTML='<i class="far fa-star fa-2x"></i>',b.classList.remove('checked'),b.setAttribute('aria-checked',!1),DBHelper.addFavoriteRestaurant(c,!1)):(b.innerHTML='<i class="fas fa-star fa-2x"></i>',b.classList.add('checked'),b.setAttribute('aria-checked',!0),DBHelper.addFavoriteRestaurant(c,!0))}},submitReview=(a)=>{a.preventDefault();const b=Date.now(),c=a.target,d=parseInt(c.dataset.id);let e={restaurant_id:d,createdAt:b,updatedAt:b};const f=new FormData(c);for(const b of f)e[b[0]]=b[1];const g=c.getElementsByTagName('button');g[0].className='disabled';const h=document.getElementById('spinner');h.style.display='block',DBHelper.postSubmittedReview(e).then(()=>{c.reset(),g[0].classList.remove('disabled'),h.style.display='none';const a=document.getElementById('submitted-message');a.style.display='block',setTimeout(()=>{a.style.display='none'},5e3)});const i=document.getElementById('reviews-list');i.prepend(createReviewHTML(e))};const form=document.getElementById('review-form');form.addEventListener('submit',submitReview),window.addEventListener('online',DBHelper.offlineMessage);