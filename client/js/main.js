let restaurants,neighborhoods,cuisines;var map,markers=[];DBHelper.serviceWorker(),DBHelper.fetchReviews(),document.addEventListener('DOMContentLoaded',()=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach((a)=>{const c=document.createElement('option');c.innerHTML=a,c.value=a,b.append(c)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach((a)=>{const c=document.createElement('option');c.innerHTML=a,c.value=a,b.append(c)})},window.initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,e=a[c].value,f=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(e,f,(a,b)=>{a?console.error(a):(resetRestaurants(b),fillRestaurantsHTML())})},resetRestaurants=(a)=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach((a)=>a.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach((a)=>{b.append(createRestaurantHTML(a))}),addMarkersToMap(),lazyLoad()},createRestaurantHTML=(a)=>{const b=document.createElement('li'),c=document.createElement('img');c.className='restaurant-img',c.alt=a.alt,c.setAttribute('data-src',DBHelper.imageUrlForRestaurant(a)),b.append(c);const d=document.createElement('h3');d.innerHTML=a.name,b.append(d);const e=document.createElement('p');e.innerHTML=a.neighborhood,b.append(e);const f=document.createElement('p');f.innerHTML=a.address,b.append(f);const g=document.createElement('a');g.innerHTML='View Details',g.setAttribute('aria-label','View details about '+a.name+' restaurant'),g.href=DBHelper.urlForRestaurant(a),b.append(g);const h=document.createElement('div');return h.addEventListener('click',togFav),h.addEventListener('keydown',togFavKey),h.setAttribute('data-id',a.id),h.className=`favorite-icon ${a.is_favorite?'checked':''}`,h.setAttribute('aria-checked',!!a.is_favorite),h.setAttribute('aria-label','Mark restaurant as favorite'),h.setAttribute('tabindex',0),h.setAttribute('role','checkbox'),h.innerHTML=a.is_favorite?'<i class="fas fa-star fa-2x"></i>':'<i class="far fa-star fa-2x"></i>',b.append(h),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach((a)=>{const b=DBHelper.mapMarkerForRestaurant(a,self.map);google.maps.event.addListener(b,'click',()=>{window.location.href=b.url}),self.markers.push(b)})},skipTo=(a)=>{const b=document.getElementById(a);b.focus()},togFav=(a)=>{const b=a.target.parentNode,c=b.dataset.id;b.classList.contains('checked')?(b.innerHTML='<i class="far fa-star fa-2x"></i>',b.classList.remove('checked'),b.setAttribute('aria-checked',!1),DBHelper.addFavoriteRestaurant(c,!1)):(b.innerHTML='<i class="fas fa-star fa-2x"></i>',b.classList.add('checked'),b.setAttribute('aria-checked',!0),DBHelper.addFavoriteRestaurant(c,!0))},togFavKey=(a)=>{if(32===a.keyCode){a.preventDefault();const b=a.target,c=b.dataset.id;b.classList.contains('checked')?(b.innerHTML='<i class="far fa-star fa-2x"></i>',b.classList.remove('checked'),b.setAttribute('aria-checked',!1),DBHelper.addFavoriteRestaurant(c,!1)):(b.innerHTML='<i class="fas fa-star fa-2x"></i>',b.classList.add('checked'),b.setAttribute('aria-checked',!0),DBHelper.addFavoriteRestaurant(c,!0))}},lazyLoad=()=>{const a=document.querySelectorAll('img[data-src]');a.forEach((a)=>{a.setAttribute('src',a.getAttribute('data-src')),a.onload=()=>{a.removeAttribute('data-src')}})};